"use strict";!function(){var a=window.angular,b=window.$;a.module("frontendApp",["ngAnimate","angulartics","angulartics.google.analytics","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngDialog","monospaced.qrcode","ui.bootstrap"]).config(["$routeProvider","$locationProvider",function(a,c){a.when("/",{templateUrl:"views/quiz.html",controller:"QuizCtrl"}).when("/quiz",{templateUrl:"views/quiz.html",controller:"QuizCtrl"}).when("/video",{templateUrl:"views/video.html",controller:"VideoCtrl"}).when("/matrix-meta",{templateUrl:"views/meta.html",controller:"DivCtrl"}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/matrix",{templateUrl:"views/div.html",controller:"DivCtrl"}).when("/blog",{templateUrl:"views/20150812-hk-legco-analysis.html",controller:"BlogCtrl"}).when("/blog-hans",{templateUrl:"views/20150812-hk-legco-analysis-hans.html",controller:"BlogCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/play",{templateUrl:"views/play.html",controller:"PlayCtrl"}).when("/div",{templateUrl:"views/div.html",controller:"DivCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/20150812-hk-legco-analysis",{templateUrl:"views/20150812-hk-legco-analysis.html",controller:"BlogCtrl"}).when("/20150812-hk-legco-analysis-hans",{templateUrl:"views/20150812-hk-legco-analysis-hans.html",controller:"BlogCtrl"}).otherwise({redirectTo:"/"});var d=b('meta[name="html5Mode"]').first().attr("content");d={"true":!0,"false":!1}[d],console.log("html5Mode: "+d),c.html5Mode(d)}])}(),function(){var a=window.angular;a.module("frontendApp").controller("MainCtrl",["$scope",function(a){}])}(),function(){var a=window.angular;a.module("frontendApp").controller("AboutCtrl",["$scope","$location","$http",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],console.log(b.path());var d="api/hk-legco-pointers/hk-legco-pointers.json";c.get(d).success(function(b){console.log("Get projects success"),a.projects=b}).error(function(){console.log("Get projects error")})}])}(),function(){var a=window.angular,b=window.$,c=window._,d=window.Shepherd;a.module("frontendApp").controller("DivCtrl",["$rootScope","$scope","$http","LegcoApi",function(a,e,f,g){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.$on("$locationChangeStart",function(a,b,c){console.log("location changing to:"+b),e.tour.cancel()});var h=function(a){var b=function(a,b,c){a=parseInt(a,16),b=parseInt(b,16);var d=Math.floor(c*b+(1-c)*a);return(d+256).toString(16).substr(-2).toUpperCase()};return"#"+b("ee","1C",a)+b("ee","64",a)+b("ee","6D",a)};e.legends=c.map([0,.2,.4,.5,.6,.8,1].reverse(),function(a){return{value:a,valuePercentage:(100*a).toString(10)+"%",color:h(a)}}),e.isLoadingTransDictMover=!0,e.isLoadingTransDictVoter=!0,e.isLoadingMVRelation=!0,g.get("transdict-mover.json",function(a){e.isLoadingTransDictMover=!1,e.transDictMover=a,e.rangeMovers=c.range(1,Object.keys(e.transDictMover).length+1)},function(a){console.log("loading failure")}),g.get("transdict-voter.json",function(a){e.isLoadingTransDictVoter=!1,e.transDictVoter=a,e.rangeVoters=c.range(1,Object.keys(e.transDictVoter).length+1)},function(a){console.log("loading failure")}),g.get("mv-relation.json",function(a){e.isLoadingMVRelation=!1,e.mvRelation=a;for(var b=0;b<e.mvRelation.length;b++)for(var c=0;c<e.mvRelation[b].length;c++){var d=e.mvRelation[b][c],f=Math.round(100*d);e.mvRelation[b][c]={value:d,valuePercentage:f,color:h(d)}}},function(a){console.log("loading failure")}),e.currentStep=0;var i=function(a){console.log(a),e.stories=c.map(a.feed.entry,function(a){return a});var f=new d.Tour({defaults:{classes:"shepherd-theme-arrows",scrollTo:!0}}),g=function(a){var c=b("#style-info #"+a).css("font-size");return parseInt(c.substr(0,c.length-2),10)},h=g("cell-size"),i=g("cell-spacing"),j=h+i,k=16*j,l=10*j;for(var m in e.stories){var n=e.stories[m],o="frame"+m,p="frame"+m,q=b("<div></div>").attr("id",o).addClass("guide-frame");q.appendTo("#legco");for(var r=JSON.parse(n.gsx$rectangles.$t),s=0;s<r.length;s++){var t=r[s],u=b("<div></div>").addClass("rectangle").addClass(p);u.css("top",l+j*(t[0]-1)-1+"px"),u.css("left",k+j*(t[1]-1)-1+"px"),u.css("width",(t[3]-t[1]+1)*j),u.css("height",(t[2]-t[0]+1)*j),u.appendTo(q)}var v=function(){var a=".frame"+e.currentStep;b(".rectangle").hide(),b(a).show()};e.nextFunc=function(){e.currentStep+=1,v(),f.next(),e.$apply()},e.backFunc=function(){e.currentStep-=1,v(),f.back(),e.$apply()};var w=[];m>0&&w.push({text:"上條",action:e.backFunc}),m<e.stories.length-1&&w.push({text:"下條",action:e.nextFunc}),f.addStep("Step"+m,{title:n.gsx$title.$t,text:n.gsx$text.$t,attachTo:"."+p,buttons:w})}b(".rectangle").hide(),b(".frame0").show(),f.start(),e.tour=f};g.get("navigation-data.json",i,function(a){console.log("loading failure")})}])}(),function(){var a=window.angular;a.module("frontendApp").controller("PlayCtrl",["$scope","$http",function(a,b){a.myPromise1=b.get("https://spreadsheets.google.com/feeds/list/1s2CkDX0sMaZHzHjl_hbJs8DkyUAca08enU1te3aEPUU/od6/public/values?alt=json"),a.myPromise2=b.get("/api/mv-relation.json"),a.myPromise3=b.get("/api/transdict-mover.json"),a.myPromise4=b.get("/api/transdict-voter.json")}])}(),function(){var a=window.angular;a.module("frontendApp").controller("HeaderCtrl",["$scope","$location","LegcoConfig",function(a,b,c){a.isActive=function(a){return a===b.path()},a.showHeader=!0,a.getRealPath=c.getRealPath}])}(),function(){var a=window.angular;a.module("frontendApp").controller("HomeCtrl",["$scope",function(a){}])}(),function(){var a=window.angular,b=window.$;a.module("frontendApp").controller("QuizCtrl",["$rootScope","$scope","$timeout","ngDialog","LegcoConfig",function(a,c,d,e,f){c.quizes=[{question:"你知道立法會中的提案獲得支持票總數最高是哪位議員嗎？",choices:["梁振英","梁家傑","梁家騮","梁國雄","梁美芬"],answerIndex:3,explanation:"梁國雄獲得了約2000張支持票，在70位議員中最高，但他自己提出了一千多個議案，所以大部分支持票都是自己給自己投的。"},{question:"本屆立法會曾有議員投票反對自己的議案，猜猜是哪一位？",choices:["葉劉淑儀","李慧琼","黃毓民","曾鈺成","劉皇發"],answerIndex:1,explanation:"李慧琼曾任財政預算案修正案的委員會主席，此委員會泛民居多，委員會內部通過的修正案李慧琼並不贊成，但是作為委員會主席她需要以主席身份向大會提交修正案。之後她又以民建聯成員身份對此提案投反對票。"},{question:"有一位建制派議員，提出的議案受泛民支持多於建制派支持，這又是哪一位？",choices:["陳婉嫻","譚耀宗","葛珮帆","王國興","潘兆平"],answerIndex:4,explanation:"潘兆平提出的多為民生議題，受許多泛民議員的歡迎。"}];for(var g=0;g<c.quizes.length;g++)c.quizes[g].answerFromUser=-1;c.quizFinished=!1,c.updateQuizStatus=function(){c.showAnswer=!1,d(function(){c.showAnswer=!0},200),d(function(){},300)},c.questionID=0,c.showQuizFinishedNotice=!1,c.nextQuiz=function(){console.log(c.questionID),b(".quiz").hide(),b("#quiz-block-"+c.questionID).show(),c.questionID+=1,c.questionID>3&&(c.showQuizFinishedNotice=!0)},d(function(){c.nextQuiz()},200),c.getRealPath=f.getRealPath}])}(),function(){var a=window.angular,b=window.localStorage,c=window.XMLHttpRequest;a.module("frontendApp").controller("BlogCtrl",["$scope","$location",function(a,d){function e(a,b){var d="http://s.init.im:8081/remember/legcoweb/",e=new c,f={username:k.uuid,key:a,value:b,raw:"",datetime:Date.now()};e.open("POST",d,!0),e.setRequestHeader("Content-Type","application/json charset=UTF-8");var g=JSON.stringify(f);e.send(g),console.log("tried to post "+g)}function f(a){return function(){var b=encodeURIComponent(k.description),c=encodeURIComponent(a),d=encodeURIComponent(k.title);window.open("https://www.facebook.com/dialog/feed?app_id=1485405728425484&link="+c+"&name="+d+"&description="+b+"&redirect_uri="+c),e("share","facebook")}}function g(a){return function(){var b=encodeURIComponent(a),c=encodeURIComponent(k.description);window.open("http://service.weibo.com/share/share.php?title="+c+"&url="+b),e("share","weibo")}}function h(a){return function(){var b=encodeURIComponent(a),c=encodeURIComponent(k.description);window.open("https://twitter.com/intent/tweet?text="+c+b),e("share","twitter")}}function i(){var a=document.getElementById("divVideoQRCode");a.style.display="block",e("share","wechat")}function j(){var a=document.getElementById("divArticleQRCode");a.style.display="block",e("share","wechat")}a.urlToThisPage=d.absUrl();var k={videoURL:"https://www.youtube.com/watch?v=PIgbvFyOnwA"};k.generalTitle=document.getElementById("generalTitle")||{},console.log(k.generalTitle.innerText),"廿一世紀立會網絡"===k.generalTitle.innerHTML?(k.lang="hant",k.title="廿一世紀立會網絡",k.description="端傳媒「一圖看懂香港立法會」，泛民制一目了然。有人不提案，也有人投自己反對票。漲知識啊",k.url="http://legco.initiumlab.com/20150812-hk-legco-analysis"):(k.lang="hans",k.title="廿一世纪立会网络",k.description="端传媒「一图看懂香港立法会」，泛民制一目了然。有人不提桉，也有人投自己反对票。涨知识啊",k.url="http://legco.initiumlab.com/20150812-hk-legco-analysis-hans"),k.setUUID=function(){var a=this;if(b.getItem("uuid"))a.uuid=b.getItem("uuid");else{var d="http://s.init.im:8081/utility/uuid/",e="LocalDefault"+Math.random().toString();a.uuid=e,b.setItem("uuid",e);var f=new c;f.open("GET",d,!0),f.onload=function(){if(console.log("UUID server responded"),f.status>=200&&f.status<400){var c=JSON.parse(f.responseText);c.success&&(e=c.data.uuid)}a.uuid=e,b.setItem("uuid",e)},f.send()}};var l=function(a){var b=document.createElement("p"),c=document.getElementById("shareVideoToFacebookAnchor");return c?c:b};l("shareVideoToFacebookAnchor").addEventListener("click",f(k.videoURL),!1),l("shareVideoToWeiboAnchor").addEventListener("click",g(k.videoURL),!1),l("shareVideoToTwitterAnchor").addEventListener("click",h(k.videoURL),!1),l("shareVideoToWeChatAnchor").addEventListener("click",i,!1),l("btnCloseWeChatVideoSharePopup").addEventListener("click",function(){document.getElementById("divVideoQRCode").style.display="none"},!1),l("shareArticleToFacebookAnchor").addEventListener("click",f(a.urlToThisPage),!1),l("shareArticleToWeiboAnchor").addEventListener("click",g(a.urlToThisPage),!1),l("shareArticleToTwitterAnchor").addEventListener("click",h(a.urlToThisPage),!1),l("shareArticleToWeChatAnchor").addEventListener("click",j,!1),l("btnCloseWeChatArticleSharePopup").addEventListener("click",function(){document.getElementById("divArticleQRCode").style.display="none"},!1),k.setUUID(),e("render",k.lang+"-rendered");var m=l("introVideo");m.addEventListener("click",function(){this.paused?this.play():this.pause(),e("video","clicked")},!1)}])}(),function(){var a=window.angular;a.module("frontendApp").controller("VideoCtrl",["$scope",function(a){}])}(),function(){var a=window.angular,b=window.$;a.module("frontendApp").service("LegcoConfig",function(){var a={getBaseURL:function(){var a=b("base").first().attr("href");return a},getApiBaseURL:function(){var b=a.getBaseURL();return b+"api/"},getPathScheme:function(){var a=b('meta[name="pathScheme"]').first().attr("content");return a},getRealPath:function(b){var c=a.getBaseURL(),d=a.getPathScheme(),e=c+d+b;return"//"===e&&(e="/"),e}};return a})}(),function(){var a=window.angular;a.module("frontendApp").service("LegcoApi",["$http","LegcoConfig",function(a,b){var c=b.getApiBaseURL();console.log(c);var d={getApiBaseURL:function(){return c},logMsgCallback:function(a,b){return a?a:function(){console.log(b)}},get:function(b,c,e){c=d.logMsgCallback(c,"Get success: "+c),e=d.logMsgCallback(e,"Get error:"+e),a.get(d.getApiBaseURL()+b).success(c).error(e)},post:function(b,c,e){c=d.logMsgCallback(c,"Post success: "+c),e=d.logMsgCallback(e,"Post error:"+e),a.get(d.getApiBaseURL()+b).success(c).error(e)}};return d}])}();